<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Detalhes do Jogo</title>
<link rel="shortcut icon" href="imagens/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="style.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="text-white" style="background-color: #10101D;">
	<div id="header"></div>
	<div id="saudacao-usuario"
		style="text-align: right; padding: 10px 30px 0 0; font-weight: bold; color: rgb(148, 233, 21);"></div>

	<main class="container mt-5">
		<section id="detalhes-jogo"
			class="detalhes-jogo row justify-content-center">
			<!-- Conteúdo dinâmico -->
		</section>

		<!-- Comentários -->
<section class="comentarios-section mt-5">
  <h4 class="text-white mb-3">Comentários</h4>

  <!-- Novo Comentário -->
  <div class="card bg-dark text-white">
    <div class="card-body">
      <h5 class="card-title">Novo Comentário</h5>
      <form id="comentario-form">
        <!-- Comentário -->
        <div class="mb-3">
          <label for="comentarioTexto" class="form-label">Escreva seu comentário:</label>
          <textarea class="form-control" id="comentarioTexto" rows="3" required></textarea>
        </div>

        <!-- Nota (select dropdown) -->
        <div class="mb-3">
          <label for="comentarioNota" class="form-label">Nota:</label>
          <select class="form-select" id="comentarioNota" required>
            <option value="" disabled selected>Escolha uma nota</option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        <!-- Botão -->
        <button type="submit" class="btn btn-success" style="background-color: rgb(148, 233, 21);">
          Enviar Comentário
        </button>
      </form>
    </div>
  </div>
</section>


	</main>

	<div id="footer" class="mt-5"></div>

	<script>
    // Header e login
    fetch('header.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('header').innerHTML = data;
        fetch('/ProjetoGames/api/usuario-logado')
          .then(res => res.json())
          .then(data => {
            if (data.nome) {
              document.getElementById('saudacao-usuario').textContent = `Bem-vindo, ${data.nome}`;
              const loginLogoutLi = document.getElementById('loginLogoutLink');
              if (loginLogoutLi) {
                loginLogoutLi.innerHTML = `<a class="nav-link" href="/ProjetoGames/LogoutServlet">Logout</a>`;
              }
            }
          });
      });

    fetch('footer.html')
      .then(res => res.text())
      .then(data => document.getElementById('footer').innerHTML = data);

    async function carregarDetalhesJogo() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      try {
        const resposta = await fetch('/ProjetoGames/api/jogos');
        const jogos = await resposta.json();
        const jogo = jogos.find(j => j.id == id);

        if (!jogo) {
          document.getElementById('detalhes-jogo').innerHTML = `<p class="text-danger">Jogo não encontrado.</p>`;
          return;
        }

        document.getElementById('detalhes-jogo').innerHTML = `
        	<div class="detalhes-container d-flex flex-wrap p-4 rounded">
        	  <div class="imagem-col me-4 mb-3">
        	    <img src="imagens/${jogo.nomeImagem}" class="img-fluid rounded shadow" alt="${jogo.titulo}">
        	  </div>
        	  <div class="info-col text-white">
        	    <h2>${jogo.titulo}</h2>
        	    <p><strong>Preço:</strong> R$ ${jogo.preco.toFixed(2)}</p>
        	    <p><strong>Desenvolvedor:</strong> ${jogo.desenvolvedor || 'Não informado'}</p>
        	    <p><strong>Ano de Lançamento:</strong> ${jogo.anoLancamento || 'Desconhecido'}</p>
        	    <p><strong>Gênero:</strong> ${jogo.genero || 'Aventura'}</p>
        	    <p><strong>Classificação:</strong> ${jogo.classificacao || 'Livre'}</p>
        	    <p><strong>Idioma:</strong> ${jogo.idioma || 'Português'}</p>
        	    <p><strong>Plataforma:</strong> ${jogo.plataformas?.join(', ') || 'Multiplataforma'}</p>
        	    <p><strong>Avaliação:</strong> ${jogo.avaliacao || 'Sem avaliações'}</p>
        	    <p><strong>Sinopse:</strong> ${jogo.sinopse}</p>
        	    <a href="index.html" class="btn-voltar">Voltar</a>
        	  </div>
        	</div>

        `;
      } catch (erro) {
        console.error('Erro ao carregar detalhes:', erro);
      }
    }

    carregarDetalhesJogo();
  </script>
</body>
</html>